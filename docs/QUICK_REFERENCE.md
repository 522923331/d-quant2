# d-quant2 å®Œå–„æŒ‡å— - å¿«é€Ÿå‚è€ƒ

> åŸºäº QuantOL, qstock, OSkhQuant, sphinx-quant å››ä¸ªé¡¹ç›®çš„æ¶æ„åˆ†æ

---

## ğŸ“š æ–‡æ¡£å¯¼èˆª

1. **[æ¶æ„å¯¹æ¯”åˆ†ææŠ¥å‘Š](./architecture_comparison.md)** - è¯¦ç»†çš„æ¶æ„å¯¹æ¯”å’Œåˆ†æ
2. **[å¼€å‘è·¯çº¿å›¾](./development_roadmap.md)** - å®Œæ•´çš„å¼€å‘ä»»åŠ¡æ¸…å•
3. **æœ¬æ–‡æ¡£** - å¿«é€Ÿå‚è€ƒå’Œæ ¸å¿ƒè¦ç‚¹

---

## ğŸ¯ æ ¸å¿ƒå·®è·ï¼ˆå¿…é¡»å®Œå–„ï¼‰

### 1. é£æ§æ¨¡å— â­â­â­â­â­
**å½“å‰çŠ¶æ€**: åŸºç¡€æ¡†æ¶ï¼ŒåŠŸèƒ½ä¸å®Œæ•´  
**ç›®æ ‡çŠ¶æ€**: å®Œæ•´çš„é£æ§ç³»ç»Ÿ

**å¿…é¡»å®ç°**ï¼š
- âœ… è®¢å•éªŒè¯ï¼ˆèµ„é‡‘æ£€æŸ¥ã€ä»“ä½é™åˆ¶ï¼‰
- âœ… é£é™©æŒ‡æ ‡ç›‘æ§ï¼ˆVaR, CVaR, Betaï¼‰
- âœ… æ­¢æŸæ­¢ç›ˆæœºåˆ¶

**å‚è€ƒæ–‡ä»¶**: `QuantOL/src/core/risk/risk_manager.py` (53è¡Œ)

---

### 2. æŠ•èµ„ç»„åˆæ¨¡å— â­â­â­â­â­
**å½“å‰çŠ¶æ€**: åŸºç¡€åŠŸèƒ½ï¼Œç¼ºå°‘ä¼˜åŒ–  
**ç›®æ ‡çŠ¶æ€**: é«˜æ€§èƒ½ç»„åˆç®¡ç†ç³»ç»Ÿ

**å¿…é¡»å®ç°**ï¼š
- âœ… ç¼“å­˜ä¼˜åŒ–ï¼ˆLRUç¼“å­˜ï¼‰
- âœ… FIFOæˆæœ¬è®¡ç®—
- âœ… ç»„åˆå†å¹³è¡¡

**å‚è€ƒæ–‡ä»¶**: `QuantOL/src/core/portfolio/portfolio.py` (480è¡Œ)

---

### 3. æ•°æ®æŒä¹…åŒ– â­â­â­â­â­
**å½“å‰çŠ¶æ€**: ä»…æœ‰å†…å­˜ç¼“å­˜  
**ç›®æ ‡çŠ¶æ€**: å®Œæ•´çš„æ•°æ®åº“æ”¯æŒ

**å¿…é¡»å®ç°**ï¼š
- âœ… SQLite é€‚é…å™¨
- âœ… å­—æ®µæ˜ å°„å™¨
- âœ… æ•°æ®è´¨é‡æ£€æŸ¥

**å‚è€ƒæ–‡ä»¶**: `QuantOL/src/core/data/sqlite_adapter.py` (2100+è¡Œ)

---

### 4. è§„åˆ™å¼•æ“ â­â­â­â­
**å½“å‰çŠ¶æ€**: ä¸æ”¯æŒ  
**ç›®æ ‡çŠ¶æ€**: æ”¯æŒ DSL è¡¨è¾¾å¼ç­–ç•¥

**å¿…é¡»å®ç°**ï¼š
- âœ… è¡¨è¾¾å¼è§£æå™¨ï¼ˆå¦‚ "MA(5) > MA(20) and RSI < 30"ï¼‰
- âœ… æŒ‡æ ‡å‡½æ•°åº“
- âœ… è§„åˆ™éªŒè¯å™¨

**å‚è€ƒæ–‡ä»¶**: `QuantOL/src/core/strategy/rule_parser.py` (1200+è¡Œ)

---

### 5. äº¤æ˜“æ‰§è¡Œæ¨¡å— â­â­â­â­
**å½“å‰çŠ¶æ€**: ä¸æ”¯æŒ  
**ç›®æ ‡çŠ¶æ€**: å®Œæ•´çš„è®¢å•ç®¡ç†ç³»ç»Ÿ

**å¿…é¡»å®ç°**ï¼š
- âœ… è®¢å•ç®¡ç†ï¼ˆåˆ›å»ºã€å–æ¶ˆã€æŸ¥è¯¢ï¼‰
- âœ… æˆäº¤å›æŠ¥æœºåˆ¶
- âœ… å¤šç§è®¢å•ç±»å‹ï¼ˆå¸‚ä»·ã€é™ä»·ã€æ­¢æŸï¼‰

**å‚è€ƒæ–‡ä»¶**: `QuantOL/src/core/execution/Trader.py` (310+è¡Œ)

---

## ğŸ—‚ï¸ æ¨¡å—å¯¹æ¯”é€Ÿè§ˆ

| æ¨¡å— | d-quant2 ç°çŠ¶ | QuantOL æ ‡å‡† | å·®è· |
|------|--------------|--------------|------|
| **æ•°æ®æ¨¡å—** | âš ï¸ åŸºç¡€ | âœ… å®Œå–„ | ç¼ºå°‘æŒä¹…åŒ–ã€å­—æ®µæ˜ å°„ |
| **å›æµ‹æ¨¡å—** | âš ï¸ åŸºç¡€ | âœ… å®Œå–„ | ç¼ºå°‘å¤šè®¢å•ç±»å‹ã€å‚æ•°ä¼˜åŒ– |
| **ç­–ç•¥æ¨¡å—** | âš ï¸ åŸºç¡€ | âœ… å®Œå–„ | ç¼ºå°‘è§„åˆ™å¼•æ“ã€ç­–ç•¥ç»„åˆ |
| **æŠ•èµ„ç»„åˆ** | âš ï¸ åŸºç¡€ | âœ… å®Œå–„ | ç¼ºå°‘ç¼“å­˜ä¼˜åŒ–ã€å†å¹³è¡¡ |
| **é£æ§æ¨¡å—** | âŒ ç¼ºå¤± | âœ… å®Œå–„ | éœ€è¦ä»é›¶å®ç° |
| **äº¤æ˜“æ‰§è¡Œ** | âŒ ç¼ºå¤± | âœ… å®Œå–„ | éœ€è¦ä»é›¶å®ç° |
| **äº‹ä»¶æ€»çº¿** | âš ï¸ åŸºç¡€ | âœ… å®Œå–„ | éœ€è¦æ‰©å±•äº‹ä»¶ç±»å‹ |

---

## ğŸ“‹ ä¼˜å…ˆçº§æ’åº

### P0 - å¿…é¡»å®Œæˆï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰
1. **é£æ§æ¨¡å—** - é‡åŒ–ç³»ç»Ÿçš„å®‰å…¨ä¿éšœ
2. **æŠ•èµ„ç»„åˆä¼˜åŒ–** - æ€§èƒ½å’ŒåŠŸèƒ½æå‡
3. **æ•°æ®æŒä¹…åŒ–** - æ•°æ®ç®¡ç†åŸºç¡€
4. **å›æµ‹å¼•æ“æ‰©å±•** - æ”¯æŒæ›´å¤šè®¢å•ç±»å‹

### P1 - åº”è¯¥å®Œæˆï¼ˆé‡è¦åŠŸèƒ½ï¼‰
1. **è§„åˆ™å¼•æ“** - æå‡ç­–ç•¥å¼€å‘æ•ˆç‡
2. **äº¤æ˜“æ‰§è¡Œæ¨¡å—** - è®¢å•ç®¡ç†åŸºç¡€
3. **å‚æ•°ä¼˜åŒ–** - ç­–ç•¥è°ƒä¼˜å·¥å…·

### P2 - å¯ä»¥å®Œæˆï¼ˆå¢å¼ºåŠŸèƒ½ï¼‰
1. **å®ç›˜äº¤æ˜“æ¥å£** - å®ç›˜å¯¹æ¥
2. **æœºå™¨å­¦ä¹ ç­–ç•¥** - AIç­–ç•¥æ”¯æŒ

---

## ğŸ”‘ å…³é”®ä»£ç ç‰‡æ®µ

### é£æ§æ¨¡å—ç¤ºä¾‹
```python
# å‚è€ƒ QuantOL/src/core/risk/risk_manager.py
class RiskManager:
    def validate_order(self, order_event):
        """è®¢å•éªŒè¯"""
        if not self._check_funds(order_event):
            return False, "èµ„é‡‘ä¸è¶³"
        if not self._check_position_limit(order_event):
            return False, "è¶…è¿‡ä»“ä½é™åˆ¶"
        return True, "éªŒè¯é€šè¿‡"
    
    def _check_funds(self, order_event):
        """èµ„é‡‘æ£€æŸ¥"""
        required_cash = order_event.quantity * order_event.price * (1 + self.commission_rate)
        available_cash = self.portfolio.get_available_cash()
        return available_cash >= required_cash
```

### æŠ•èµ„ç»„åˆç¼“å­˜ä¼˜åŒ–ç¤ºä¾‹
```python
# å‚è€ƒ QuantOL/src/core/portfolio/portfolio.py
class PortfolioManager:
    def get_portfolio_value(self):
        """è·å–ç»„åˆä»·å€¼ï¼ˆå¸¦ç¼“å­˜ï¼‰"""
        import time
        current_time = time.time()
        
        # æ£€æŸ¥ç¼“å­˜
        if (self._portfolio_value_cache is not None and 
            current_time - self._cache_timestamp < self._cache_ttl):
            return self._portfolio_value_cache
        
        # è®¡ç®—ç»„åˆä»·å€¼
        total_value = self.current_cash
        for position in self.positions.values():
            total_value += position.current_value
        
        # æ›´æ–°ç¼“å­˜
        self._portfolio_value_cache = total_value
        self._cache_timestamp = current_time
        return total_value
```

### è§„åˆ™å¼•æ“ç¤ºä¾‹
```python
# å‚è€ƒ QuantOL/src/core/strategy/rule_parser.py
class RuleBasedStrategy:
    def __init__(self, buy_rule, sell_rule):
        self.buy_rule = "MA(5) > MA(20) and RSI(14) < 30"
        self.sell_rule = "MA(5) < MA(20) or RSI(14) > 70"
        self.parser = RuleParser()
    
    def generate_signal(self, data):
        if self.parser.evaluate(self.buy_rule, data):
            return Signal.BUY
        elif self.parser.evaluate(self.sell_rule, data):
            return Signal.SELL
        return Signal.HOLD
```

---

## ğŸ“– å­¦ä¹ è·¯å¾„

### ç¬¬ä¸€æ­¥ï¼šç†è§£æ¶æ„
1. é˜…è¯» [æ¶æ„å¯¹æ¯”åˆ†ææŠ¥å‘Š](./architecture_comparison.md)
2. æŸ¥çœ‹ QuantOL é¡¹ç›®çš„æ ¸å¿ƒæ¨¡å—
3. ç†è§£äº‹ä»¶é©±åŠ¨æ¶æ„

### ç¬¬äºŒæ­¥ï¼šä»é£æ§æ¨¡å—å¼€å§‹
1. é˜…è¯» `QuantOL/src/core/risk/risk_manager.py`
2. åœ¨ d-quant2 ä¸­å®ç°ç±»ä¼¼åŠŸèƒ½
3. ç¼–å†™å•å…ƒæµ‹è¯•
4. é›†æˆåˆ°å›æµ‹å¼•æ“

### ç¬¬ä¸‰æ­¥ï¼šå®Œå–„æŠ•èµ„ç»„åˆ
1. é˜…è¯» `QuantOL/src/core/portfolio/portfolio.py`
2. å®ç°ç¼“å­˜ä¼˜åŒ–
3. å®ç° FIFO æˆæœ¬è®¡ç®—
4. å®ç°ç»„åˆå†å¹³è¡¡

### ç¬¬å››æ­¥ï¼šæ•°æ®æŒä¹…åŒ–
1. é˜…è¯» `QuantOL/src/core/data/sqlite_adapter.py`
2. è®¾è®¡æ•°æ®åº“è¡¨ç»“æ„
3. å®ç° SQLite é€‚é…å™¨
4. è¿ç§»ç°æœ‰æ•°æ®

---

## âš ï¸ é‡è¦æé†’

### å¼€å‘åŸåˆ™
1. **ä¸€æ¬¡åªæ”¹ä¸€ä¸ªæ¨¡å—** - é¿å…å¼•å…¥å¤šä¸ªé—®é¢˜
2. **ä¸¥æ ¼å‚è€ƒç°æœ‰é¡¹ç›®** - ä»£ç å†™é”™å°†æ˜¯ç¾éš¾æ€§çš„
3. **å……åˆ†æµ‹è¯•** - æ¯æ¬¡ä¿®æ”¹åè¿è¡Œå®Œæ•´æµ‹è¯•
4. **å°æ­¥å¿«è·‘** - é¢‘ç¹æäº¤ï¼Œä¿æŒå¢é‡å¼å¼€å‘

### æµ‹è¯•è¦æ±‚
1. **å•å…ƒæµ‹è¯•** - æ¯ä¸ªæ–°åŠŸèƒ½å¿…é¡»æœ‰æµ‹è¯•
2. **å›æµ‹éªŒè¯** - ä¸ QuantOL å¯¹æ¯”éªŒè¯ç»“æœ
3. **æ€§èƒ½æµ‹è¯•** - ç¡®ä¿æ€§èƒ½ä¸é€€åŒ–

### ä»£ç è´¨é‡
1. **æ–‡æ¡£å­—ç¬¦ä¸²** - æ¯ä¸ªå…¬å…±æ–¹æ³•å¿…é¡»æœ‰
2. **ç±»å‹æ³¨è§£** - ä½¿ç”¨ Type Hints
3. **ä»£ç é£æ ¼** - éµå¾ª PEP 8

---

## ğŸ”— å…³é”®æ–‡ä»¶ç´¢å¼•

### QuantOL æ ¸å¿ƒæ–‡ä»¶
```
æ ¸å¿ƒæ–‡ä»¶ä½ç½®ï¼š/Users/k02/PycharmProjects/lianghua2/QuantOL/src/core/

- portfolio/portfolio.py           (480è¡Œ) - æŠ•èµ„ç»„åˆç®¡ç†
- risk/risk_manager.py             (53è¡Œ)  - é£é™©ç®¡ç†
- strategy/backtesting.py          (1800è¡Œ) - å›æµ‹å¼•æ“
- strategy/rule_parser.py          (1200è¡Œ) - è§„åˆ™è§£æå™¨
- data/sqlite_adapter.py           (2100è¡Œ) - SQLiteé€‚é…å™¨
- data/smart_data_manager.py       (600è¡Œ)  - æ™ºèƒ½æ•°æ®ç®¡ç†
- execution/Trader.py              (310è¡Œ)  - äº¤æ˜“æ‰§è¡Œ
```

### d-quant2 å¾…å®Œå–„æ–‡ä»¶
```
å¾…å®Œå–„ä½ç½®ï¼š/Users/k02/PycharmProjects/lianghua2/d-quant2/dquant2/

- core/risk/manager.py             - éœ€è¦å®Œå–„
- core/portfolio/manager.py        - éœ€è¦å®Œå–„
- core/data/storage/               - éœ€è¦æ–°å»º
- core/strategy/rule_parser.py     - éœ€è¦æ–°å»º
- core/execution/                  - éœ€è¦æ–°å»º
```

---

## ğŸ“Š æ—¶é—´ä¼°ç®—

| é˜¶æ®µ | å†…å®¹ | é¢„è®¡æ—¶é—´ |
|------|------|---------|
| **é˜¶æ®µä¸€** | é£æ§ + ç»„åˆç®¡ç† | 2-3å‘¨ |
| **é˜¶æ®µäºŒ** | æ•°æ®æŒä¹…åŒ– + å›æµ‹æ‰©å±• | 2-3å‘¨ |
| **é˜¶æ®µä¸‰** | è§„åˆ™å¼•æ“ + äº¤æ˜“æ‰§è¡Œ | 2-3å‘¨ |
| **é˜¶æ®µå››** | å®ç›˜ + MLï¼ˆå¯é€‰ï¼‰ | 6å‘¨ |
| **æ€»è®¡** | å®Œæ•´ç³»ç»Ÿ | 12-15å‘¨ |

---

## ğŸ¯ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **ç«‹å³å¼€å§‹**: é˜…è¯» `QuantOL/src/core/risk/risk_manager.py`
2. **ç¬¬ä¸€ä¸ªä»»åŠ¡**: å®ç°è®¢å•éªŒè¯æœºåˆ¶
3. **ç¬¬ä¸€ä¸ªæµ‹è¯•**: èµ„é‡‘å……è¶³æ€§æ£€æŸ¥
4. **ç¬¬ä¸€ä¸ªæäº¤**: é£æ§æ¨¡å—åŸºç¡€æ¡†æ¶

---

**æœ€åæ›´æ–°**: 2026-02-02
**ç»´æŠ¤è€…**: å‚è€ƒ architecture_comparison.md å’Œ development_roadmap.md
