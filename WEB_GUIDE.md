# d-quant2 Web 界面使用指南

## 🌐 快速启动

### 方法一：使用启动脚本（推荐）

```bash
cd /Users/k02/PycharmProjects/lianghua2/d-quant2
./start_web.sh
```

### 方法二：直接运行

```bash
cd /Users/k02/PycharmProjects/lianghua2/d-quant2
streamlit run app.py
```

启动后，浏览器会自动打开 **http://localhost:8501**

## 📱 界面功能

### 1. 侧边栏配置面板

#### 基本设置
- **股票代码**: 输入要回测的股票代码（默认000001）
- **开始日期**: YYYYMMDD格式（如20200101）
- **结束日期**: YYYYMMDD格式（如20231231）
- **初始资金**: 设置初始投资金额

#### 数据设置
- **数据源**: 
  - `mock` - 模拟数据（几何布朗运动）
  - `akshare` - 真实A股数据

#### 策略设置
- **策略**: 选择回测策略（目前支持双均线）
- **快线周期**: 短期均线天数（3-30天）
- **慢线周期**: 长期均线天数（10-60天）

#### 资金管理
- **资金策略**:
  - `fixed_ratio` - 固定比例
  - `kelly` - 凯利公式
- **投资比例**: 每次使用的资金比例

#### 交易成本
- **佣金费率**: 默认万3（0.0003）
- **滑点**: 默认0.1%（0.001）

#### 风控设置
- **最大持仓比例**: 单只股票最大仓位（10%-100%）

### 2. 主界面展示

#### 核心指标卡片
- ✅ 总收益率
- 📈 年化收益率
- 📉 最大回撤
- 📊 夏普比率

#### 详细指标表格

**收益与风险:**
- 总收益率
- 年化收益率
- 最大回撤
- 波动率
- 夏普比率
- 索提诺比率

**资金与交易:**
- 初始资金
- 最终权益
- 现金余额
- 持仓市值
- 交易次数
- 总手续费

**交易统计:**
- 胜率
- 盈亏比
- 完整交易次数

#### 可视化图表

1. **权益曲线图** 📈
   - 上半部分：总权益走势（面积图）
   - 下半部分：现金与持仓分布

2. **回撤曲线图** 📉
   - 显示最大回撤点
   - 回撤恢复过程

3. **交易记录图** 💱
   - 绿色▲：买入点
   - 红色▼：卖出点

#### 数据展示

- **交易明细表**: 可展开查看所有交易记录
- **权益曲线数据**: 每日权益、现金、持仓详情

### 3. 结果导出

- **下载配置 (JSON)**: 保存回测参数配置
- **下载交易记录 (CSV)**: 导出所有交易明细

## 🎨 界面特点

### 交互式配置
- 🎚️ 滑块调整参数
- 📝 实时参数验证
- 🔄 即时更新配置

### 可视化效果
- 📊 Plotly交互式图表
- 🔍 数据悬停查看
- 📏 时间轴缩放

### 响应式布局
- 💻 宽屏布局优化
- 📱 自适应设计
- 🎨 美观的UI设计

## 🚀 使用流程

1. **启动应用**
   ```bash
   ./start_web.sh
   ```

2. **配置参数**
   - 在左侧面板设置回测参数
   - 调整策略参数
   - 选择资金管理方式

3. **运行回测**
   - 点击「🚀 运行回测」按钮
   - 等待回测完成（会显示进度）

4. **查看结果**
   - 核心指标一目了然
   - 详细图表分析
   - 交易记录查看

5. **导出数据**
   - 下载配置文件
   - 导出交易记录

## 📸 界面预览

### 主界面布局

```
┌─────────────────────────────────────────────────────────┐
│  📈 d-quant2 量化回测系统                                │
├──────────────┬──────────────────────────────────────────┤
│              │  📊 核心指标                              │
│  ⚙️ 回测配置  │  ┌──────┬──────┬──────┬──────┐           │
│              │  │总收益│年化  │回撤  │夏普  │           │
│  基本设置     │  └──────┴──────┴──────┴──────┘           │
│  - 股票代码   │                                          │
│  - 日期范围   │  📈 详细指标                              │
│  - 初始资金   │  ┌─────────────┬─────────────┐           │
│              │  │收益与风险    │资金与交易    │           │
│  策略设置     │  └─────────────┴─────────────┘           │
│  - 策略选择   │                                          │
│  - 参数调整   │  📉 权益曲线                              │
│              │  [交互式图表]                             │
│  资金管理     │                                          │
│  - 策略类型   │  📉 回撤分析                              │
│  - 参数设置   │  [交互式图表]                             │
│              │                                          │
│  🚀 运行回测  │  💱 交易记录                              │
│              │  [交互式图表]                             │
└──────────────┴──────────────────────────────────────────┘
```

## 💡 提示

- 使用`mock`数据源可以快速测试策略逻辑
- 使用`akshare`数据源获取真实A股数据（需要安装akshare）
- 调整参数后需要重新运行回测
- 图表支持缩放、平移、悬停查看详情
- 可以下载结果进行进一步分析

## ⚠️ 注意事项

1. **首次运行**: 如果使用akshare数据源，首次运行可能需要下载数据
2. **参数验证**: 确保日期格式正确（YYYYMMDD）
3. **数据频率**: 目前支持日线数据（'d'）
4. **浏览器**: 推荐使用Chrome、Firefox或Edge

## 🛠️ 故障排除

### 无法启动

```bash
# 检查Streamlit是否安装
pip list | grep streamlit

# 重新安装依赖
pip install -r requirements.txt
```

### 端口占用

```bash
# 使用其他端口
streamlit run app.py --server.port=8502
```

### 数据加载失败

- 检查网络连接（使用akshare时）
- 尝试使用mock数据源
- 检查日期范围是否合理

## 📞 获取帮助

如有问题，请查看:
- [README.md](../README.md) - 项目说明
- [walkthrough.md](.gemini/antigravity/brain/.../walkthrough.md) - 实现总结

---

享受量化回测！ 🎉
