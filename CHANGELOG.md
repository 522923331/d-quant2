# 更新日志 (Changelog)

## [2.0.0] - 2026-02-02

### 🎉 重大更新 - 阶段一完成

这是 d-quant2 的重大更新，从基础回测工具升级为专业量化交易系统。

---

### ✨ 新增功能

#### 风控模块（完全重写）
- ✅ **8种风险指标**: VaR, CVaR, Beta, Sharpe, Sortino, Calmar, Omega, 最大回撤
- ✅ **4种止损方式**: 固定止损、移动止损、时间止损、止损追踪
- ✅ **风险预警系统**: 自动评估风险等级（低/中/高/极高）
- ✅ **订单验证**: 资金检查、仓位限制、回撤控制
- ✅ **新增文件**: `dquant2/core/risk/metrics.py`

#### 投资组合模块（大幅增强）
- ✅ **缓存优化**: LRU缓存，组合价值计算提速~10x
- ✅ **3种成本计算**: FIFO, LIFO, 加权平均
- ✅ **组合再平衡**: 目标权重调整、定期再平衡、换手率计算
- ✅ **持仓分析**: 集中度分析、盈利排行、前N大持仓
- ✅ **新增文件**: 
  - `dquant2/core/portfolio/cost_calculator.py`
  - `dquant2/core/portfolio/rebalance.py`

#### 数据模块（全新功能）
- ✅ **SQLite持久化**: 完整的数据库CRUD操作
- ✅ **字段映射器**: 支持多数据源统一（AkShare, Baostock, Tushare）
- ✅ **数据质量检查**: 完整性、一致性、异常值检测、质量评分
- ✅ **新增文件**:
  - `dquant2/core/data/storage/sqlite_adapter.py`
  - `dquant2/core/data/field_mapper.py`
  - `dquant2/core/data/quality_checker.py`

#### 回测引擎（扩展）
- ✅ **4种订单类型**: 市价单、限价单、止损单、止损限价单
- ✅ **4种滑点模型**: 固定、比例、Tick、动态滑点
- ✅ **参数优化**: 网格搜索、随机搜索、Walk-Forward框架
- ✅ **新增文件**:
  - `dquant2/backtest/order.py`
  - `dquant2/backtest/slippage.py`
  - `dquant2/backtest/optimizer.py`

#### 界面增强
- ✅ **风控仪表盘页面**: 实时风险监控和可视化
- ✅ **高级分析页面**: 数据质量检查、参数优化（框架）
- ✅ 新增2个页面，总共7个页面

---

### 🔧 改进

#### 性能优化
- ✅ LRU缓存机制（组合价值计算）
- ✅ 向量化计算（numpy/pandas）
- ✅ 数据库索引优化
- ✅ WAL模式提升并发性能

#### 代码质量
- ✅ 21个单元测试（100%通过）
- ✅ 完整的类型注解
- ✅ 详细的文档字符串
- ✅ 异常处理和日志

#### 文档
- ✅ 6份详细文档（2万+字）
- ✅ 架构对比分析
- ✅ 开发路线图
- ✅ 使用示例

---

### 🐛 修复

- ✅ 修复 Python 3.13 兼容性问题（Tornado AssertionError）
- ✅ 升级所有依赖包到最新版本
- ✅ 修复 pandas 3.0 与 Streamlit 不兼容问题

---

### 📊 统计

#### 代码
- **新增代码行数**: 2500+ 行
- **新增文件**: 12个核心文件
- **测试用例**: 21个（100%通过）

#### 功能
- **风险指标**: 8种
- **成本计算方法**: 3种
- **订单类型**: 4种
- **滑点模型**: 4种
- **止损方式**: 4种
- **优化方法**: 2种

---

### 🔗 参考项目

本次更新严格参照以下成熟项目：
1. **QuantOL** - 企业级架构，主要参考
2. **qstock** - 数据接口和向量化回测
3. **OSkhQuant** - 风控和可视化
4. **sphinx-quant** - Web架构和实盘

---

## [1.0.0] - 2026-01-15

### 初始版本
- ✅ 基础回测引擎
- ✅ 简单风控
- ✅ 数据下载和缓存
- ✅ Streamlit 界面
- ✅ 选股模块

---

## 版本说明

- **2.0.0**: 阶段一完成 - 核心模块全面增强 ✅
- **1.0.0**: 初始版本 - 基础功能

---

**维护者**: 基于 QuantOL, qstock, OSkhQuant, sphinx-quant 四个项目的架构分析
